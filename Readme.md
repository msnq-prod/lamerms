# AdamRMS: Полное руководство по функциям

AdamRMS — это веб-приложение для управления прокатным инвентарём, проектами и персоналом в театральных, аудиовизуальных и трансляционных компаниях. В этом README собраны подробные описания всех ключевых возможностей, чтобы вы могли быстро ориентироваться в системе и настроить её под задачи вашей команды.

> ⚠️ **Переход к MVP.** Мы готовим урезанную версию, которая оставляет только склад, заказы и ремонт. Перед началом работ изучите чек-лист зависимостей и рисков в документе [`docs/mvp-cutover-risks.md`](docs/mvp-cutover-risks.md) и карту актуальных модулей в [`docs/mvp-module-manifest.md`](docs/mvp-module-manifest.md).

## Быстрый запуск (Docker)

1. **Подготовьте переменные окружения.**
   ```bash
   cp .env.example .env
   ```
   Обязательно задайте `CONFIG_ROOTURL` (без завершающего `/`) и 64-символьный `CONFIG_AUTH_JWTKey`. Секрет можно сгенерировать командой `openssl rand -hex 32 | tr '[:lower:]' '[:upper:]'`. Блок SMTP в `.env` оставьте закомментированным, если уведомления склада не нужны.
2. **Запустите инфраструктуру.**
   ```bash
   docker compose up -d
   ```
   Для тестовой доставки e-mail добавьте профиль `notifications`: `docker compose --profile notifications up -d`.
3. **Проверьте, что миграции и сиды прошли успешно.** Скрипт `migrate.sh` автоматически запускается в контейнере `app` и создаёт только таблицы и данные MVP. Статус можно проверить по логам:
   ```bash
   docker compose logs app | tail
   ```
4. **Выполните smoke-тесты.** Убедитесь, что PHP код компилируется и БД готова:
   ```bash
   docker compose exec app php -l src/index.php
   docker compose exec app php vendor/bin/phinx status -e production
   ```

Приложение доступно по адресу http://localhost:8080/. Для остановки используйте `docker compose down -v`.

## Разница между MVP и полной версией

| Область | MVP | Полная версия |
| --- | --- | --- |
| Склад и операции | Остаются каталоги `src/assets*`, проектная доска `src/project/`, ремонт `src/maintenance/` и поддерживающие API. | Дополняются модулем обучения, расширенными правами доступа и публичными сайтами. |
| Администрирование бизнеса | Панель инстанса скрыта; статусы и позиции предзаданы сидерами [`db/seeds`](db/seeds). | Каталог `src/instances/` и биллинговые вебхуки восстановлены из [`legacy/`](legacy). |
| Клиенты, финансы, CRM | В MVP отсутствуют UI и API для клиентов, платежей и локаций. | Шаблоны и контроллеры перенесены в [`legacy/README.md`](legacy/README.md) и требуют архивных миграций. |
| CMS и публичные страницы | Не поставляются. | Восстанавливаются из каталога `legacy/` (оригинальные `src/cms/` и `src/public/`) и используют e-mail адаптеры из [`legacy/common/libs/Email`](legacy/common/libs/Email). |
| Проекты | Сохраняются доска, выдача и ремонт. | Модуль найма и смен доступен после возврата каталога `src/project/crew/` из legacy. |

Полный список перемещённых компонентов и их зависимостей описан в
[`legacy/README.md`](legacy/README.md) и соответствует карте модулей из
[`docs/mvp-module-manifest.md`](docs/mvp-module-manifest.md). Для возврата функционала
используйте архивные миграции из [`legacy/db/migrations`](legacy/db/migrations) в
сочетании с актуальным скриптом [`migrate.sh`](migrate.sh), который по умолчанию
запускает только ядро MVP и сиды `PositionsSeeder`, `DefaultUserSeeder`,
`ManufacturersSeeder`, `AssetCategorySeeder` и `MaintenanceJobsStatusesSeeder`.

## Содержание
- [Архитектура и ключевые компоненты](#архитектура-и-ключевые-компоненты)
- [Панель управления](#панель-управления)
- [Каталог и карточки активов](#каталог-и-карточки-активов)
- [Управление проектами](#управление-проектами)
- [Клиенты и отношения](#клиенты-и-отношения)
- [Финансы и платежи](#финансы-и-платежи)
- [Обслуживание и штрихкоды](#обслуживание-и-штрихкоды)
- [Обучение персонала](#обучение-персонала)
- [Пользователи и роли](#пользователи-и-роли)
- [Настройки бизнеса и аналитика](#настройки-бизнеса-и-аналитика)

Каждый раздел сопровождается отдельным документом в каталоге [`/discription`](discription), где вы найдёте сценарии использования, советы по настройке и рекомендации по интеграции.

## Архитектура и ключевые компоненты
Приложение построено на PHP с использованием Twig-шаблонов и распределено по тематическим модулям в каталоге [`src/`](src/). Такой подход отделяет бизнес-логику (PHP-файлы) от представления (Twig-шаблоны) и упрощает сопровождение.

Основные разделы интерфейса представлены отдельными страницами и контроллерами:
- `dashboard.twig` — стартовый экран с динамическими виджетами и календарём. 【F:src/dashboard.twig†L1-L28】
- `assets.php` и `asset.php` — каталог и подробные карточки оборудования. 【F:src/assets.php†L1-L120】【F:src/asset.php†L1-L120】
- `project/index.php` — управление проектами, статусами и доской выдачи оборудования. 【F:src/project/index.php†L1-L120】
- `clients.php` и `ledger.php` — клиентская база и финансовый учёт. 【F:src/clients.php†L1-L79】【F:src/ledger.php†L1-L39】
- `maintenance/index.php` и связанные шаблоны — обслуживание и работа с штрихкодами. 【F:src/maintenance/index.php†L1-L35】
- `training/index.php` — модуль обучения и сертификаций. 【F:src/training/index.php†L1-L104】
- `user.php` — профиль пользователя, назначения и уведомления. 【F:src/user.php†L1-L118】
- `instances/settings.php` и `instances/stats.php` — настройки бизнеса и статистика. 【F:src/instances/settings.php†L1-L15】【F:src/instances/stats.php†L1-L11】

## Панель управления
Панель управления объединяет виджеты статистики и календарь поставок/возвратов. Пользователь может добавлять и настраивать карточки с помощью набора виджетов, подключаемых через `WIDGETS.getAllDashboard()`. 【F:src/dashboard.twig†L5-L24】

Подробные сценарии настройки и кастомизации описаны в документе [`discription/dashboard.md`](discription/dashboard.md).

## Каталог и карточки активов
Каталог активов включает фильтры по инстансу, проектам, категориям, производителям, тегам и связанным группам, а также сортировку по цене, весу, стоимости и дате. 【F:src/assets.php†L6-L78】 Система поддерживает выборку по датам, скрытие архивированных или связанных позиций и управление страницами списка. 【F:src/assets.php†L18-L59】【F:src/assets.php†L82-L119】

Карточка актива раскрывает связанные экземпляры, файлы, задания обслуживания, групповые привязки, цепочки связанных предметов, штрихкоды и историю сканирований, а также хранит ссылки на место хранения. 【F:src/asset.php†L31-L180】 Подробные инструкции и советы вы найдёте в [`discription/assets.md`](discription/assets.md).

## Управление проектами
Проектный модуль объединяет аудит изменений, назначение клиентов и площадок, управление вакансиями команды и доску логистики оборудования с распределением по статусам. 【F:src/project/index.php†L1-L120】【F:src/project/index.php†L124-L205】 Настройки статусов, типов проектов, менеджеров и подзадач доступны прямо со страницы проекта. 【F:src/project/index.php†L207-L256】

Дополнительные кейсы и рекомендации описаны в [`discription/projects.md`](discription/projects.md).

## Клиенты и отношения
Раздел клиентов поддерживает поиск по контактным данным и заметкам, фильтрацию архивных записей, постраничную выдачу и подсчёт финансовых итогов по связанным проектам с учётом статуса выдачи оборудования. 【F:src/clients.php†L7-L74】 Детальнее о работе с клиентской базой читайте в [`discription/clients.md`](discription/clients.md).

## Финансы и платежи
Финансовый журнал фиксирует платежи по проектам, связывает их с клиентами и хранит вложенные документы. Доступно постраничное отображение, сортировка по дате и поиск по сумме или номеру. 【F:src/ledger.php†L6-L33】 Описание рабочих процессов и интеграций см. в [`discription/finance.md`](discription/finance.md).

## Обслуживание и штрихкоды
Модуль обслуживания выводит задания с учётом статусов, исполнителей, сроков и приоритетов, а также позволяет переключаться между текущими и завершёнными задачами. 【F:src/maintenance/index.php†L7-L32】 Карточки активов отображают связанные заявки, штрихкоды, историю последних сканирований и привязку к местоположениям для отслеживания движения. 【F:src/asset.php†L86-L170】 Подробнее — в [`discription/maintenance.md`](discription/maintenance.md).

## Обучение персонала
Раздел обучения управляет модулями, шагами и сертификациями, учитывает видимость по должностям и отслеживает прогресс каждого пользователя, включая даты начала и обновления. 【F:src/training/index.php†L9-L101】 Отдельный документ [`discription/training.md`](discription/training.md) раскрывает сценарии внедрения и контроля знаний.

## Пользователи и роли
Профили пользователей содержат параметры входа (включая внешние провайдеры), автоматическую генерацию календарных ссылок, текущие назначения на проекты, управленческие роли, список должностей и индивидуальные настройки уведомлений. 【F:src/user.php†L1-L118】 Детальный путеводитель приведён в [`discription/users.md`](discription/users.md).

## Настройки бизнеса и аналитика
Инстанс администрирования предоставляет доступ к базовым настройкам, конфигурации статусов выдачи, а также к панели бизнес-статистики с виджетами. 【F:src/instances/settings.php†L1-L15】【F:src/instances/stats.php†L5-L10】 Узнать обо всех параметрах можно из [`discription/instance-management.md`](discription/instance-management.md).
