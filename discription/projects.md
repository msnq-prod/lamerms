# Управление проектами

Модуль проектов объединяет список всех мероприятий, детальную карточку с вкладками и вспомогательные инструменты для логистики.

## Список проектов
- Страница `project/list.php` доступна пользователям с правом `PROJECTS:VIEW`, поддерживает фильтрацию по статусу, клиенту, локации и поисковому запросу. Заголовок динамически меняется в зависимости от фильтра. 【F:src/project/list.php†L4-L35】
- Параметры пагинации и лимит выдачи задаются через GET, а в результатах показываются менеджер, тип, статус и кеш финансов. Для каждого проекта подгружается список подчинённых проектов и их финансовые показатели. 【F:src/project/list.php†L37-L88】

## Карточка проекта
- При открытии `project/index.php` загружает аудит-лог, основной набор данных, клиентов, локации, возможных менеджеров и статусы. Это обеспечивает единый доступ к ключевым справочникам. 【F:src/project/index.php†L7-L238】
- Навигационная панель карточки включает вкладки «Assets», «Finance», «Crew», «Sub Projects» и «Comments» в зависимости от типа проекта и прав пользователя. Также отображаются предупреждения о блокирующих флагах и выпущенных активах. 【F:src/project/project_index.twig†L70-L118】
- Блок деталей содержит кнопки быстрого добавления всех активов, редактирования клиента, менеджера и даты. Архивированные проекты помечаются отдельным предупреждением. 【F:src/project/project_index.twig†L124-L155】

## Управление активами
- При включённом модуле активов карточка строит массив `BOARDASSETS`, группируя оборудование по статусам выдачи для основного и подчинённых проектов. Это основа для доски диспетчеризации и статусов выдачи. 【F:src/project/index.php†L110-L205】
- На вкладке «Assets List» пользователи видят назначенные активы с их текущими статусами, а переключение «Add Assets» ведёт прямо в каталог с автозаполнением ID проекта. 【F:src/project/project_index.twig†L99-L104】

## Финансы и документация
- Вкладка «Finance» появляется, если тип проекта поддерживает финансы и у пользователя есть доступ. Она подключает шаблон `project_finance.twig` с журналом операций. 【F:src/project/project_index.twig†L105-L108】
- Раздел «Files, Notes, Invoices & Quotes» объединяет файловое хранилище, заметки и генерацию документов, автоматически скрывая недоступные части в зависимости от типа проекта. 【F:src/project/project_index.twig†L105-L107】

## Команда и подчинённые проекты
- Вкладка «Crew» отображается только при активированном модуле экипажа и доступе пользователя, предоставляя интерфейс для назначения ролей и отслеживания заявок. 【F:src/project/project_index.twig†L109-L110】
- Если у проекта есть дочерние элементы, вкладка «Sub Projects» показывает их расписание и основные данные, что помогает управлять сложными мероприятиями. 【F:src/project/project_index.twig†L112-L114】

## Настройки и права
- Возможность смены статуса, типа проекта и менеджера формируется в `project/index.php` при наличии соответствующих прав. Дополнительно вычисляется флаг `canCreateSubProjects`, который учитывает квоту инстанса. 【F:src/project/index.php†L207-L246】
- Модальное окно создания финансовых проводок и связанный JavaScript обеспечивают работу кнопок «Add Payment Received», «Add Sales Item» и других действий прямо с карточки проекта. 【F:src/project/project_index.twig†L428-L498】【F:src/project/project_index.twig†L1337-L1375】

## Практические советы
1. Используйте фильтры списка проектов, чтобы строить отчёты по статусам, клиентам или площадкам — заголовок страницы подскажет активный контекст. 【F:src/project/list.php†L11-L35】
2. Проверяйте предупреждения о блокировках активов в начале карточки: они сигнализируют о сервисных задачах или выпущенном статусе, который может привести к двойному бронированию. 【F:src/project/project_index.twig†L73-L90】
3. Для проектов с большим количеством подчинённых элементов используйте вкладку «Sub Projects», чтобы синхронизировать графики и делегировать управление менеджерам дочерних проектов. 【F:src/project/project_index.twig†L112-L114】
